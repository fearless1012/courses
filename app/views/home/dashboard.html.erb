<head>
  <title>Courses</title>
  <%= stylesheet_link_tag "application", :media => "all" %>
  <%= stylesheet_link_tag "bwizard", :media => "all" %>
  <%= csrf_meta_tags %>
</head>
<body>
  <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
	<a class="brand" href="/">Courses</a>
	<ul class="nav local">
	  <li class="divider-vertical"></li>
	  <li><%= link_to "Departments", "/departments" %></li>
	</ul>
	<% if @user.nil? %>
	<ul class="nav local pull-right">
	  <li id="signin_link">
	    <a href="/login">Sign In</a></li>
	</ul>
	<% else %>
	<ul class="nav pull-right">
	  <li class="dropdown">
	    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
	      <strong>
		<i class="icon-user"></i>
		  <%= @user[:name] %></strong>
	      <b class="caret"></b>
	    </a>
	    <ul class="dropdown-menu local" role="menu" aria-labelledby="dropdownMenu">
	      <li class="disabled"><a href=""><small>My Courses</small></a></li>
	      <li><a href="/courses/1">Advanced Database Management Systems</a></li>
	      <li><a href="/courses/3">Real-Time Systems</a></li>
	      <li><a href="/courses/10">Data Warehousing and Data Mining</a></li>
	      <li><a href="/courses/2">Industrial Economics</a></li>
	      <li class="divider"></li>
	      <li><a href="/me">My Profile</a></li>
	      <li><a href="/signout">Sign out</a></li>
	    </ul>
	  </li>
	</ul>
	<% end %>
      </div>
    </div>
  </div>
  <div id="wrap">
    <div class="container" id="content"></div>
  </div>
  <div id="footer">
    <div class="container">
      <p class="muted credit">
	&copy; 2013 - Developed by <%= link_to "Shiva Nandan", "https://github.com/seekshiva", target: '_blank' %>.
      </p>
    </div>
  </div>

  <script type="text/template" id="login-template">
    <form class="form-signin" action="/authenticate" method="post">
      <h2 class="form-signin-heading">Please sign in</H2>
      <% unless flash[:notice].nil? %>
      <div class="alert <%= flash[:notice_type] %>">
	<%= flash[:notice] %>
      </div>
      <% end %>
      <p class="alert alert-info">
	Enter your nitt webmail credentials
      </p>
      <div class="field">
	<div class="input-append">
	  <input type="text" name="username" style="text-align: right" class="input-small" placeholder="username">
	  <span class="add-on">@nitt.edu</span>
	</div>
      </div>
      <div class="field">
	<input type="password" name="password" style="text-align: right; " class="input-medium" placeholder="password">
      </div>
      <div class="field">
	<input type="submit" class="btn btn-large btn-primary" value="Sign In">
      </div>
    </form>
  </script>
  
  <script type="text/template" id="departments-template">
    <table class="table table-hover">
      <thead>
	<tr>
	  <th>Department</th>
	  <th>HOD</th>
	</tr>
      </thead>
      <tbody>
	{{#each depts}}
	<tr>
	  <td>
	    <a href="/departments/{{this.id}}">{{this.name}}</a>
	  </td>
	  <td>{{this.hod}}</td>
	</tr>
	{{/each}}
      </tbody>
    </table>
  </script>

  <script type="text/template" id="department-template">
    <h3 style="font-weight: 400; ">
      <a href="/departments" class="btn btn-small" title="Department List">
	<i class="icon-chevron-left"></i>
      </a>
      <small>{{dept.short}}</small>
      {{dept.name}}
    </h3>
    <div>
      Headed by <strong>{{dept.hod}}</strong>
    </div>
    <div class="s-push"></div>

    <table class="table table-hover">
      <caption>
	<h4>Courses Offered</h4>
	<div class="s-push"></div>
      </caption>
      <thead>
	<tr>
	  <th>Course</th>
	  <th>Course Instructor</th>
	  <th># credits</th>
	</tr>
      </thead>
      <tbody>
	{{#each dept.course_list}}
	<tr><th colspan="3">{{this.semester}}</th></tr>
	{{#each this.courses}}
	<tr>
	  <td>
	    <a href="/courses/{{this.id}}">
	      {{this.subject_code}} - {{this.name}}
	    </a>
	  </td>
	  <td>
	    <small>
	      {{#each this.instructors}}
	      {{this}}
	      {{/each}}
	    </small>
	  </td>
	  <td>{{this.credits}}</td>
	</tr>
	{{/each}}

	{{/each}}
      </tbody>
    </table>
  </script>


  <script type="text/template" id="course-template">
    <h3>
      <small>{{course.subject_code}}</small>
      {{course.name}}
    </h3>
    {{#if course.instructors}}
    <p>
      <strong>Course Instructor:</strong>
      {{#each course.instructors}}
      <span class="label label-info">{{this}}</span>
      {{/each}}
    </p>
    {{/if}}

    <ul class="nav nav-tabs" id="specialized_view_selector">
      <li><span class="nav_container">
	  <strong class="label label-info">{{course.credits}} credits</strong>
	  {{#each course.departments}}
	  <a class="btn btn-mini" href="/departments/{{this.id}}">
	    {{this.short}}
	  </a>
	  {{/each}}
      </span></li>
      <li id="view_by_topic"><a href="/courses/{{course.id}}/topics">Topics</a></li>
      <li id="view_by_class"><a href="/courses/{{course.id}}/classes">Classes</a></li>
      <li id="view_reference_books"><a href="/courses/{{course.id}}/books">
	  Reference Books
	  <small class="badge">{{course.reference_books.length}}</small>
      </a></li>
    </ul>
    <div id="specialized_view"></div>
 </script>

  
  <script type="text/template" id="course-topic-template">
    <table class="table bottom_line">
      <tbody>
	{{#unless course.topics}}
	<tr><td>
	    <p>No topic has been added to this course yet.</p>
	    <p>Contact your course instructor to add topics this course.</p>
	</td></tr>
	{{/unless}}
	{{#each course.topics}}
	<tr><td>
	    <dl>
	      <dt>
		<a href="/courses/{{../course.id}}/topics/{{this.id}}">{{this.title}}</a>
		<span class="label label-success">{{this.ct_status}}</span>
	      </dt>
	      <dd>
		<p>
		  <small>
		    {{#if this.classes}}
		    This topic was taught on
		    {{#each this.classes}}
		    {{this.date}}
		    {{/each}}
		    
		    {{else}}
		    This topic has not been taught so far this semester
		    {{/if}}
		  </small>
		</p>

		<p>{{this.description}}</p>
		<table class="table-hover table-bordered">
		  <thead><tr>
		      {{#each this.reference}}
		      <th><small>{{this.book}}</small></th>
		      {{/each}}
		  </tr></thead>
		  <tbody><tr>
		      {{#each this.reference}}
		      <td><small>{{this.sections}}</small></td>
		      {{/each}}
		  </tr></tbody>
		</table>
	      </dd>
	    </dl>
	</td></tr>
	{{/each}}
      </tbody>
    </table>
  </script>
  
  <script type="text/template" id="course-class-template">
    <table class="table bottom_line">
      <tbody>
	{{#unless course.classes}}
	<tr><td>
	    No classes have been taught in this course this semester.
	</td></tr>
	{{/unless}}
	{{#each course.classes}}
	<tr><td>
	    <dl>
	      <dt>
		{{this.date}}, {{this.time}}
		<small>at {{this.room}}</small>
	      </dt>
	      <dd>
		<strong>
		  Topics covered
		</strong>
		<ul>
		  {{#each this.topics}}
		  <li>
		    {{this.title}}
		  </li>
		  {{/each}}
		</ul>
	      </dd>
	    </dl>
	</td></tr>
	{{/each}}
      </tbody>
  </script>

  <script type="text/template" id="course-reference-book-template">
    <table class="table bottom_line">
      <tbody>
	{{#unless course.reference_books }}
	No reference book found for this course.
	{{/unless}}

	{{#each course.reference_books}}
	<tr><td style="padding: 20px;">
	    <b><a href="/books/{{this.id}}">{{this.title}}</a> ({{this.year}})</b>
	    by
	    {{#each this.authors}}
	    <a href="/authors/{{this.id}}">{{this.name}}</a>;
	    {{/each}}
	    <br />
	    {{this.publisher}}, {{this.edition}} <b><i>{{this.isbn}}</i></b>
	</td></tr>
	{{/each}}
      </tbody>
    </table>

  </script>

  <script type="text/template" id="404-template">
    <h3 style="font-size: 60px; margin: 30px; ">Its a 404!</h3>
    <p class="lead">This means, the page you're trying to access does not exist!</p>
    <div>
      <a href="javascript:history.back()" class="btn">
	<i class="icon-chevron-left"></i> Back
      </a>
      <a href="/" class="btn">
	<i class="icon-home"></i> Home
      </a>
    </div>
  </script>

  <% unless @user.nil? %>
  <div id="profileModal" class="modal hide fade" tabindex="-1">
    <div class="modal-header">
      <button class="close pull-right" data-dismiss="modal">&times;</button>
      <h3><%= @user.name %></h3>
      <div>
	<%= link_to "#{@user.email}@nitt.edu", "mailto:#{@user.email}@nitt.edu" %>
      </div>
    </div>
    <div class="modal-body">
      <div>
	<%= link_to "Department of #{@user.department.name}", "/departments/#{@user.department.id}" %>
      </div>
      <strong>Courses attending:</strong>
      <ul>
	<li>Hi</li>
      </ul>
    </div>
    <div class="modal-footer">
      <button class="btn">Edit</button>
    </div>
  </div>
  <% end %>

  <% unless @user.nil? %>
  <script type="text/javascript">
    var app = window.app ? window.app : {};
    app.user = <%= raw @user.to_json %>
  </script>
  <% end %>

  <%= javascript_include_tag "vendor" %>
  <%= javascript_include_tag "application" %>
  <script type="text/javascript">
    renderSignupModal(app.user);
  </script>
</body>
